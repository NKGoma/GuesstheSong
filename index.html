<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0">
  <meta name="theme-color" content="#0d0d14">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Norster">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="manifest" href="./manifest.json">
  <link rel="apple-touch-icon" href="./icon-192.png">
  <link rel="stylesheet" href="./style.css">
  <title>Norster â€“ Music Timeline Game</title>
</head>
<body>

<!-- ==================== TOAST CONTAINER ==================== -->
<div class="toast-container" id="toast-container"></div>

<!-- ==================== SPLASH / START ==================== -->
<div class="screen active" id="screen-start">
  <div class="splash-logo">ğŸµ</div>
  <div class="splash-title">NOR<span>STER</span></div>
  <div class="splash-subtitle">Music Timeline Game</div>
  <div class="splash-actions">
    <button class="btn btn-spotify btn-lg btn-block" id="btn-connect-spotify">
      Connect Spotify
    </button>
    <button class="btn btn-primary btn-lg btn-block" id="btn-new-game" style="display:none">
      ğŸ® New Game
    </button>
    <button class="btn btn-secondary btn-block" id="btn-setup-client">
      âš™ï¸ Spotify Setup
    </button>
    <button class="btn btn-ghost btn-block" id="btn-logout" style="margin-top:4px">
      Disconnect Spotify
    </button>
  </div>
  <div class="splash-footer">
    <span id="user-status"></span>
  </div>
</div>

<!-- ==================== CONFIG / SPOTIFY SETUP ==================== -->
<div class="screen" id="screen-config">
  <div class="app-header">
    <button class="header-btn" id="btn-config-back">â† Back</button>
    <div class="app-logo">NOR<span>STER</span></div>
    <div style="width:56px"></div>
  </div>
  <div class="screen-scroll">
    <div class="setup-content">

      <div class="setup-step">
        <div class="step-number">1</div>
        <h3>Create a Spotify App</h3>
        <p>Go to <strong>developer.spotify.com</strong> â†’ Log in â†’ "Create App".<br>
           Name it anything, e.g. "Norster".</p>
        <a href="https://developer.spotify.com/dashboard" target="_blank" rel="noopener"
           class="btn btn-secondary btn-sm" style="margin-top:4px">
          Open Spotify Dashboard â†—
        </a>
      </div>

      <div class="setup-step">
        <div class="step-number">2</div>
        <h3>Add your Redirect URI</h3>
        <p>In your Spotify app settings under <strong>"Redirect URIs"</strong>, add exactly this URL:</p>
        <div class="copy-url-box" id="redirect-uri-display"></div>
        <p style="margin-top:8px;font-size:12px">Tap to copy, then paste it in Spotify.</p>
      </div>

      <div class="setup-step">
        <div class="step-number">3</div>
        <h3>Enter Your Client ID</h3>
        <p>Copy the <strong>Client ID</strong> from your Spotify app's settings page.</p>
        <div class="input-group">
          <label class="input-label" for="input-client-id">Client ID</label>
          <input type="text" id="input-client-id" placeholder="e.g. 3a8f2b1c4dâ€¦" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
        </div>
        <button class="btn btn-primary btn-block" id="btn-save-client-id" style="margin-top:12px">
          Save & Continue
        </button>
      </div>

      <div class="setup-step" style="border-color: var(--primary); background: var(--primary-glow);">
        <div class="step-number" style="background: var(--warning); color: #000;">!</div>
        <h3>Requirements</h3>
        <p>You need <strong>Spotify Premium</strong> for the app to control music playback remotely.<br><br>
           Without Premium, you'll get a link to open tracks in Spotify manually.</p>
      </div>

    </div>
  </div>
</div>

<!-- ==================== PLAYLISTS ==================== -->
<div class="screen" id="screen-playlists">
  <div class="app-header">
    <button class="header-btn" id="btn-playlists-back">â† Back</button>
    <div class="app-logo">NOR<span>STER</span></div>
    <div style="width:56px"></div>
  </div>
  <div class="section-title">Choose a Playlist</div>
  <div class="screen-scroll" style="padding-bottom:0">
    <div id="playlist-grid" style="padding:0 16px 24px">
      <div class="loading-state"><div class="spinner"></div><p>Loading playlistsâ€¦</p></div>
    </div>
  </div>
</div>

<!-- ==================== LOADING TRACKS ==================== -->
<div class="screen" id="screen-loading-tracks" style="align-items:center;justify-content:center;padding:40px">
  <div class="spinner" style="width:48px;height:48px;margin-bottom:20px"></div>
  <h2 style="text-align:center">Loading songsâ€¦</h2>
  <p id="loading-playlist-name" style="text-align:center;margin-top:8px"></p>
</div>

<!-- ==================== PLAYER SETUP ==================== -->
<div class="screen" id="screen-players">
  <div class="app-header">
    <button class="header-btn" id="btn-players-back">â† Back</button>
    <div class="app-logo">NOR<span>STER</span></div>
    <div style="width:56px"></div>
  </div>
  <div class="screen-scroll">
    <div style="padding:16px 20px 0">
      <div class="highlight-box">
        ğŸµ <strong id="selected-playlist-name"></strong><br>
        <span id="selected-track-count" style="color:var(--text-muted);font-size:12px"></span>
      </div>
    </div>

    <div class="section-title">Players</div>
    <div id="player-list" class="player-list"></div>
    <button class="add-player-btn" id="btn-add-player">+ Add Player</button>

    <div class="section-title" style="margin-top:8px">Difficulty</div>
    <div id="difficulty-options" class="difficulty-options"></div>

    <div class="section-title" style="margin-top:8px">Starting Tokens</div>
    <div class="token-setting">
      <label>Tokens per player</label>
      <div class="token-control">
        <button class="token-btn" id="btn-token-minus">âˆ’</button>
        <span class="token-value" id="token-value">3</span>
        <button class="token-btn" id="btn-token-plus">+</button>
      </div>
    </div>
    <p style="padding:8px 20px 0;font-size:12px">
      Use tokens to: <strong>Skip</strong> a song (âˆ’1 token), or earn them by naming songs (Pro/Expert mode).
    </p>
  </div>

  <div class="setup-footer">
    <button class="btn btn-primary btn-block btn-lg" id="btn-start-game-setup">
      Continue â†’
    </button>
  </div>
</div>

<!-- ==================== DEVICE SETUP ==================== -->
<div class="screen" id="screen-device">
  <div class="app-header">
    <button class="header-btn" id="btn-device-back">â† Back</button>
    <div class="app-logo">NOR<span>STER</span></div>
    <div style="width:56px"></div>
  </div>
  <div class="screen-scroll">
    <div class="device-content">

      <div class="device-status" id="device-status">
        <div class="device-icon">ğŸ“±</div>
        <h2>Connect Spotify</h2>
        <p>Finding active devicesâ€¦</p>
      </div>

      <div class="steps-list">
        <div class="step-row">
          <div class="step-num">1</div>
          <div class="step-text">Tap <strong>Open Spotify</strong> below to launch the Spotify app</div>
        </div>
        <div class="step-row">
          <div class="step-num">2</div>
          <div class="step-text">In Spotify, tap play on <strong>any song</strong> for a second</div>
        </div>
        <div class="step-row">
          <div class="step-num">3</div>
          <div class="step-text">Come <strong>back to this app</strong> and tap "Check Again"</div>
        </div>
      </div>

      <div style="display:flex;gap:10px">
        <button class="btn btn-spotify btn-block" id="btn-open-spotify">
          Open Spotify ğŸµ
        </button>
        <button class="btn btn-secondary btn-block" id="btn-check-devices">
          Check Again â†º
        </button>
      </div>

      <div id="device-list" class="device-list"></div>

    </div>
  </div>

  <div class="setup-footer">
    <button class="btn btn-primary btn-block btn-lg" id="btn-start-game" disabled>
      Start Game â†’
    </button>
  </div>
</div>

<!-- ==================== GAME ==================== -->
<div class="screen" id="screen-game">

  <!-- Header -->
  <div class="game-header">
    <div class="game-top-row">
      <div>
        <div class="current-player-label">Now Playing</div>
        <div class="current-player-name" id="current-player-name">Player 1's turn</div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px">
        <div class="player-tokens" id="player-tokens"></div>
        <div style="font-size:11px;color:var(--text-muted)" id="token-count-label">3 tokens</div>
      </div>
    </div>
    <div class="score-bar" id="score-bar"></div>
    <div class="score-label" id="score-label">0 / 10 songs</div>
    <div class="player-tabs" id="player-tabs"></div>

    <button class="header-btn" id="btn-game-menu"
            style="position:absolute;top:calc(var(--safe-top) + 8px);right:16px;font-size:18px">
      âœ•
    </button>
  </div>

  <!-- Main area: song card + controls -->
  <div class="game-main">

    <!-- Playing indicator -->
    <div id="playing-indicator" style="display:none">
      <div class="playing-bars">
        <div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div>
      </div>
      <span class="playing-indicator" style="font-size:11px;letter-spacing:1px">NOW PLAYING</span>
    </div>

    <!-- Song card -->
    <div class="song-card">
      <div class="song-card-art">
        <img id="song-art-img" src="" alt="" class="hidden">
        <div class="art-blur-overlay" id="art-blur-overlay">
          <div class="art-mystery">ğŸµ</div>
          <div class="art-mystery-text">LISTENINGâ€¦</div>
        </div>
      </div>
      <div class="song-card-info">
        <!-- Hidden state (shimmer) -->
        <div class="song-hidden-info" id="song-hidden-info">
          <div class="hidden-bar medium"></div>
          <div class="hidden-bar short"></div>
          <div class="hidden-bar" style="width:40%;height:28px;border-radius:8px;margin-top:4px"></div>
        </div>
        <!-- Revealed state -->
        <div class="song-reveal-info" id="song-reveal-info">
          <div class="song-title" id="song-title-reveal">Song Title</div>
          <div class="song-artist" id="song-artist-reveal">Artist</div>
          <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
            <div class="song-year" id="song-year-reveal">2000</div>
            <div style="font-size:12px;color:var(--text-muted)" id="song-album-reveal"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Playback controls -->
    <div class="playback-controls">
      <button class="play-btn" id="btn-play" aria-label="Play/Pause">â–¶</button>
      <button class="reveal-btn" id="btn-reveal" disabled>
        <span id="reveal-btn-text">ğŸ‘ Reveal Song</span>
      </button>
    </div>

    <!-- Spotify fallback link -->
    <a id="btn-open-spotify-fallback" href="#" target="_blank"
       class="btn btn-spotify btn-sm" style="display:none">
      Open track in Spotify â†—
    </a>

  </div>

  <!-- Footer actions -->
  <div class="game-footer">

    <!-- Expert: year guess -->
    <div class="year-guess-section" id="year-guess-section">
      <div class="year-guess-label">ğŸ¯ Guess the year (before revealing):</div>
      <div class="year-guess-input">
        <button class="year-adj" id="btn-year-minus">âˆ’</button>
        <input type="number" class="year-input" id="year-guess-input" value="2000" min="1900" max="2025">
        <button class="year-adj" id="btn-year-plus">+</button>
      </div>
    </div>

    <!-- Pre-reveal actions -->
    <div class="game-actions-pre" id="game-actions-pre">
      <button class="btn btn-ghost btn-sm" id="btn-skip" style="flex:1">
        â­ Skip (âˆ’1ğŸª™)
      </button>
    </div>

    <!-- Post-reveal actions -->
    <div class="game-actions-post" id="game-actions-post">
      <button class="btn btn-warning btn-sm" id="btn-named-it" style="display:none;flex:1">
        ğŸ¤ Named it! +1ğŸª™
      </button>
      <button class="btn btn-success" id="btn-correct" style="flex:1;font-size:18px">âœ“</button>
      <button class="btn btn-danger" id="btn-wrong" style="flex:1;font-size:18px">âœ—</button>
    </div>

  </div>
</div>

<!-- ==================== END ==================== -->
<div class="screen" id="screen-end">
  <div class="winner-trophy">ğŸ†</div>
  <div class="winner-label">Hitster!</div>
  <div class="winner-name" id="winner-name">Player 1</div>

  <div class="final-scores" id="final-scores"></div>

  <div class="end-actions">
    <button class="btn btn-primary btn-lg btn-block" id="btn-play-again">
      ğŸ”„ Play Again (same players)
    </button>
    <button class="btn btn-secondary btn-block" id="btn-end-home">
      ğŸ  Home
    </button>
  </div>
</div>

<!-- ==================== SCRIPTS ==================== -->
<script src="./app.js"></script>
</body>
</html>
